<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AIæµå¼æµ‹è¯•</title>
    <style>
        body { max-width: 600px; margin: 50px auto; font-family: sans-serif; padding: 20px; }
        #result {
            border: 1px solid #ddd;
            padding: 20px;
            min-height: 100px;
            white-space: pre-wrap; /* ä¿ç•™æ¢è¡Œ */
            background: #f9f9f9;
            border-radius: 8px;
            margin-top: 20px;
        }
        .cursor { display: inline-block; width: 5px; height: 15px; background: #000; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body>
<h2>ğŸ”® AI æµå¼å¯¹è¯æµ‹è¯•</h2>
<input type="text" id="question" value="çŒ«å’ªæ„Ÿå†’äº†æ€ä¹ˆåŠ" style="width: 70%; padding: 10px;">
<button onclick="startChat()" style="padding: 10px 20px;">å‘é€</button>

<div id="result"></div>

<script>
    function startChat() {
        const q = document.getElementById('question').value;
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = ''; // æ¸…ç©ºä¸Šä¸€æ¡
        resultDiv.innerHTML = '<span id="text"></span><span class="cursor"></span>';
        const textSpan = document.getElementById('text');

        // æ ¸å¿ƒä»£ç ï¼šä½¿ç”¨ EventSource è¿æ¥åç«¯
        // æ³¨æ„ï¼šè¿™é‡Œåœ°å€è¦å¡«ä½  Spring Boot çš„å®é™…åœ°å€
        const eventSource = new EventSource(`http://localhost:8080/ai-chat/test?q=${encodeURIComponent(q)}`);

        // ç›‘å¬æ¶ˆæ¯
        eventSource.onmessage = function(event) {
            console.log("æ”¶åˆ°æ•°æ®:", event.data);
            // è¿½åŠ æ–‡å­—
            textSpan.innerText += event.data;
        };

        // ç›‘å¬é”™è¯¯ (è¿æ¥ç»“æŸä¹Ÿä¼šè§¦å‘ error)
        eventSource.onerror = function(event) {
            console.log("è¿æ¥ç»“æŸæˆ–æŠ¥é”™");
            eventSource.close(); // å…³é—­è¿æ¥
            document.querySelector('.cursor').style.display = 'none'; // éšè—å…‰æ ‡
        };
    }
</script>
</body>
</html>